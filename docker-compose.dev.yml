# Development override for Docker Compose
# Use: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  backend:
    ports:
      - "8000:8000"
    volumes:
      - ./data/mirrors:/data/mirrors:ro
      - ./backend/app:/app/app:ro
    environment:
      - LOG_LEVEL=DEBUG
  
  sync:
    volumes:
      - ./data/mirrors:/data/mirrors
    environment:
      - LOG_LEVEL=DEBUG
  
  nginx:
    ports:
      - "8080:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/sites/dev.conf:/etc/nginx/sites-enabled/default.conf:ro
      - ./frontend/public:/var/www/public:ro
      - ./data/mirrors/freebsd/pub/FreeBSD:/data/mirrors/freebsd/pub/FreeBSD:ro
      - ./data/mirrors/netbsd/pub/NetBSD:/data/mirrors/netbsd/pub/NetBSD:ro
      - ./data/mirrors/openbsd/pub/OpenBSD:/data/mirrors/openbsd/pub/OpenBSD:ro
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
